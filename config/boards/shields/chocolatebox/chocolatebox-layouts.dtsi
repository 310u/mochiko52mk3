#include "./position_map.dtsi"
#include <physical_layouts.dtsi>

/* KLE順で keys[] を並べ直し。positions は 0..51 をそのまま行順に貼るだけでOK。 */

 /{
  chocolatebox_physical_layout: chocolatebox_physical_layout {
    compatible = "zmk,physical-layout";
    display-name = "Chocolatebox";
    transform = <&default_transform>;
    kscan = <&kscan0>;

    /* 回転ブロックの支点 */
    /* 左列群 KLE {r:10, rx:20, ry:3} → rot=10, (rx,ry)=(2000,300) */
    /* 右列群 KLE {r:-10, rx:11.75}   → rot=350, (rx,ry)=(3175,300) */

    keys =
    /* ---------- Row1: 1 2 3 4 5 6 7 8 9 0 - = (非回転) ---------- */
      <&key_physical_attrs 100 100   75    0   0   0    0>  /*  0: 1  */
    , <&key_physical_attrs 100 100  175    0   0   0    0>  /*  1: 2  */
    , <&key_physical_attrs 100 100  275    0   0   0    0>  /*  2: 3  */
    , <&key_physical_attrs 100 100  375    0   0   0    0>  /*  3: 4  */
    , <&key_physical_attrs 100 100  475    0   0   0    0>  /*  4: 5  */
    , <&key_physical_attrs 100 100  575    0   0   0    0>  /*  5: 6  */
    , <&key_physical_attrs 100 100  875    0   0   0    0>  /*  6: 7  */
    , <&key_physical_attrs 100 100  975    0   0   0    0>  /*  7: 8  */
    , <&key_physical_attrs 100 100 1075    0   0   0    0>  /*  8: 9  */
    , <&key_physical_attrs 100 100 1175    0   0   0    0>  /*  9: 0  */
    , <&key_physical_attrs 100 100 1275    0   0   0    0>  /* 10: -  */
    , <&key_physical_attrs 100 100 1375    0   0   0    0>  /* 11: =  */

    /* ---------- Row2:   q w e r t   y u i o p enter ---------- */
    /* 左10°ブロック（q w e r t） */
    , <&key_physical_attrs 100 100   200  100  10  2000 300>  /* 12: q */
    , <&key_physical_attrs 100 100   300  100  10  2000 300>  /* 13: w */
    , <&key_physical_attrs 100 100   400  100  10  2000 300>  /* 14: e */
    , <&key_physical_attrs 100 100   500  100  10  2000 300>  /* 15: r */
    , <&key_physical_attrs 100 100   600  100  10  2000 300>  /* 16: t */
    /* 右350°ブロック（y u i o p enter） */
    , <&key_physical_attrs 100 100  1500  100 350  3175 300>  /* 17: y */
    , <&key_physical_attrs 100 100  1600  100 350  3175 300>  /* 18: u */
    , <&key_physical_attrs 100 100  1700  100 350  3175 300>  /* 19: i */
    , <&key_physical_attrs 100 100  1800  100 350  3175 300>  /* 20: o */
    , <&key_physical_attrs 100 100  1900  100 350  3175 300>  /* 21: p */
    , <&key_physical_attrs 125 200  2025  100   0     0   0>  /* 22: enter（1.25u×2u） */

    /* ---------- Row3:   a s d f g   h j k l ; ---------- */
    /* 左10°（a s d f g） */
    , <&key_physical_attrs 100 100   150  200  10  2000 300>  /* 23: a */
    , <&key_physical_attrs 100 100   250  200  10  2000 300>  /* 24: s */
    , <&key_physical_attrs 100 100   350  200  10  2000 300>  /* 25: d */
    , <&key_physical_attrs 100 100   450  200  10  2000 300>  /* 26: f */
    , <&key_physical_attrs 100 100   550  200  10  2000 300>  /* 27: g */
    /* 右350°（h j k l ;） */
    , <&key_physical_attrs 100 100  1500  200 350  3175 300>  /* 28: h */
    , <&key_physical_attrs 100 100  1600  200 350  3175 300>  /* 29: j */
    , <&key_physical_attrs 100 100  1700  200 350  3175 300>  /* 30: k */
    , <&key_physical_attrs 100 100  1800  200 350  3175 300>  /* 31: l */
    , <&key_physical_attrs 100 100  1900  200 350  3175 300>  /* 32: ; */

    /* ---------- Row4: lshift z x c v   b n m , . rshift ---------- */
    /* 左10°（lshift z x c v） */
    , <&key_physical_attrs 125 100    75  300  10  2000 300>  /* 33: lshift (1.25u) */
    , <&key_physical_attrs 100 100   225  300  10  2000 300>  /* 34: z */
    , <&key_physical_attrs 100 100   325  300  10  2000 300>  /* 35: x */
    , <&key_physical_attrs 100 100   425  300  10  2000 300>  /* 36: c */
    , <&key_physical_attrs 100 100   525  300  10  2000 300>  /* 37: v */
    /* 右350°（b n m , . rshift） */
    , <&key_physical_attrs 100 100  1450  300 350  3175 300>  /* 38: b */
    , <&key_physical_attrs 100 100  1550  300 350  3175 300>  /* 39: n */
    , <&key_physical_attrs 100 100  1650  300 350  3175 300>  /* 40: m */
    , <&key_physical_attrs 100 100  1750  300 350  3175 300>  /* 41: , */
    , <&key_physical_attrs 100 100  1850  300 350  3175 300>  /* 42: . */
    , <&key_physical_attrs 125 100  1975  300   0     0   0>  /* 43: rshift (1.25u) */

    /* ---------- Row5:   win lalt space fn   fn bspc ralt rctrl ---------- */
    /* 左10°（win lalt space fn） */
    , <&key_physical_attrs 100 100   250  400  10  2000 300>  /* 44: win   */
    , <&key_physical_attrs 125 100   350  400  10  2000 300>  /* 45: lalt  (1.25u) */
    , <&key_physical_attrs 225 100   500  400  10  2000 300>  /* 46: space (2.25u) */
    , <&key_physical_attrs 100 100   750  400  10  2000 300>  /* 47: fn    */
    /* 右350°（fn bspc ralt rctrl） */
    , <&key_physical_attrs 100 100  1550  400 350  3175 300>  /* 48: fn    */
    , <&key_physical_attrs 225 100  1675  400   0     0   0>  /* 49: bspc  (2.25u) */
    , <&key_physical_attrs 125 100  1925  400   0     0   0>  /* 50: ralt  (1.25u) */
    , <&key_physical_attrs 125 100  2075  400   0     0   0>  /* 51: rctrl (1.25u) */
    ;
  };
};

/* Studioの行表示をそのままにした positions（0..51 連番） */
&layouts_chocolatebox_position_map {
  layout_chocolatebox_map: layout_mable {
    physical-layout = <&chocolatebox_physical_layout>;
    positions
      = <  0  1  2  3  4  5   6  7  8  9 10 11 >
      , <    12 13 14 15 16   17 18 19 20 21 22 >
      , <    23 24 25 26 27   28 29 30 31 32    >
      , < 33 34 35 36 37 38   39 40 41 42 43    >
      , <    44 45 46 47      48 49 50 51       >
      ;
  };
}
